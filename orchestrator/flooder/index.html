<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Flooder Case Study - DeterLab Documentation (DEPRECATED)</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  <link href="../../css/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Flooder Case Study";
    var mkdocs_page_input_path = "orchestrator/flooder.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
    <a href="" class="icon">
      <!--REPLACE LOGO FILE HERE -->
      <img class="logo" style="float:left" src="img/doc-logo.png"/> 
      <span class="title">DeterLab Documentation (DEPRECATED)</span></a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Welcome to the DETERLab Documentation</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../Glossary/">Glossary</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../quickstart/">Quickstart</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Opening Account</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../support/research/">Research users</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../support/class/">Class users</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Running Experiments</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../core/topology/">Create a topology</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../core/create/">Create an experiment</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../core/swapin/">Swap in an experiment</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../core/interact/">Use your nodes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../core/swapout/">Swap out or terminate</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../core/user-guidelines/">User DOs and DON'Ts</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Advanced Features</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../containers/containers-quickstart/">Containers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dsc/">Nework Emulation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../core/risky-experiment/">Risky Experiments</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://binary.deterlab.net/docs">Binary Analysis</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../competitions/">Competitions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../">Orchestrator</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../dash/">Human user emulation</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Sharing</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../core/sample-topologies/">Sample Topologies</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../core/sharing/">Shared Materials</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Deterlab for Classes</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../education/">Education Materials Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../education/guidelines-for-teachers/">Guidelines for Teachers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../education/class-support/">Class Support</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../education/course-setup/">Course Setup</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../education/good-teaching-practices/">Good Teaching Practices</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../education/connect-with-teachers/">Connect With Other Teachers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../education/guidelines-for-students/">Guidelines for Students</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../education/public-materials/">Public Materials</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Reference</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../core/deterlab-commands/">DETERLab commands</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../core/ns-commands/">NS commands</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Support</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../support/migration/">Migration Instructions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../support/getting-help/">Getting Help</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../support/faqs/">FAQs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../support/usage-policy/">Usage Policy</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">DeterLab Documentation (DEPRECATED)</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Flooder Case Study</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="flooder-case-study">Flooder Case Study<a class="headerlink" href="#flooder-case-study" title="Permanent link"></a></h1>
<p>In this experiment we demonstrate how one can setup a flooding agent and a victim server. </p>
<p>We demonstrate three aspects of MAGI: </p>
<ul>
<li>Specifying multiple event streams, </li>
<li>Synchronizing with triggers, and</li>
<li>A special target called <code>exit</code> to unload agents.</li>
</ul>
<h2 id="event-streams">Event Streams<a class="headerlink" href="#event-streams" title="Permanent link"></a></h2>
<p>This experiment has three streams: the <strong>flooder stream</strong>, the <strong>server stream</strong>, and the <strong>cleanup stream</strong>. </p>
<p>The co-ordination between the events can be illustrated as follows:</p>
<p><img alt="Event diagram" src="../event.png" /></p>
<p>Event streams can be synchronized using event-based triggers or time-based triggers.</p>
<p>The triggers are indicated as wait states in gray. The group formation and loading the agents, which is also automated by the orchestrator tool, is not illustrated above.</p>
<h2 id="server-stream">Server Stream<a class="headerlink" href="#server-stream" title="Permanent link"></a></h2>
<p>The server event stream consists of three states. The start state which generates a trigger, called serverStarted, once the server agent is activated on the experiment nodes.</p>
<p>It then enters the wait state and stays there for a period ∆t and terminates the server agent in stop state. </p>
<p>The AAL description is below:</p>
<pre><code>serverstream: 
    - type: event
    agent: server_agent 
    method: startServer
    trigger: serverStarted 
    args: {}

    - type: trigger
    triggers: [ { timeout: 180000 } ]

    - type: event
    agent: server_agent 
    method: stopServer 
    trigger: serverStopped 
    args: {} 
</code></pre>
<h2 id="flooder-stream">Flooder Stream<a class="headerlink" href="#flooder-stream" title="Permanent link"></a></h2>
<p>The flooder stream consists of five states. First, the flooder agent implementation is parameterized by the configuration state. This occurs as part of the agent loading process. </p>
<p>The flooder stream then synchronizes with the server stream by waiting for the serverStarted trigger from the server nodes. Once it receives the trigger the flooder agent is activated in the start state.</p>
<p>Next, the flooder stream waits for a period of ∆t before repeating the start and stop events one more time while waiting for a period of ∆t in between. Finally, the flooder stream terminates the flooder agent in the stop state. </p>
<p>The AAL description is as follows:</p>
<pre><code>flooderstream:
    - type: event
    agent: flooder_agent
    method: setConfiguration
    args:
            dst: '10.1.1.3'
            proto: 'udp'
            length: 'minmax(64, 1024)'
            ratetype: 'flat'
            highrate: '5000'
            lowrate: '5000'
            sport: 'minmax(1024, 4096)'
            dport: 'minmax(1024, 4096)'

    - type: trigger
    triggers: [ { event: serverStarted } ] 

    - type: event
    agent: flooder_agent
    method: startFlood
    args: {}

    - type: trigger
    triggers: [ { timeout: 60000 } ]

    - type: event
    agent: flooder_agent
    method: stopFlood
    args: {}

    - type: trigger
    triggers: [ { timeout: 60000 } ]

    - type: event
    agent: flooder_agent
    method: startFlood
    args: {}

    - type: trigger
    triggers: [ { timeout: 60000 } ]

    - type: event
    agent: flooder_agent
    method: stopFlood
    args: {}
</code></pre>
<h2 id="cleanup-stream">Cleanup Stream<a class="headerlink" href="#cleanup-stream" title="Permanent link"></a></h2>
<p>The last event stream, the cleanup stream consists of two states. First, it waits for the server to stop and then it enters the exit state.</p>
<p>The exit state unload and tears down all the comminucation mechanisms between the agents. The exit state is entered by the key target is used to transfer control to a reserved state internal to the orchestrator.</p>
<p>It causes the orchestrator to send agent unload and disband group messages to all the experiment node and then it exits the orchestrator.</p>
<pre><code>cleanupstream:
    - type: trigger
    triggers: [ {event: serverStopped, target: exit} ] 
</code></pre>
<h2 id="running-the-experiment">Running the experiment<a class="headerlink" href="#running-the-experiment" title="Permanent link"></a></h2>
<ul>
<li>Swap in the experiment using the network description file given below.</li>
<li>Set up your environment. Assuming your experiment is named myExp, your DETER project is myProj, and the AAL file is called procedure.aal.</li>
</ul>
<pre><code class="language-bash">$ export PROJ=myExp
$ export EXP=myProj
$ export AAL=procedure.aal
</code></pre>
<ul>
<li>Once the experiment is swapped in, run the orchestrator, giving it the AAL above. The orchestrator needs an AAL file, and the experiment and project name. The example output below uses the project “montage” with experiment “caseClientServer”.</li>
</ul>
<pre><code class="language-bash">$ /share/magi/current/magi_orchestrator.py --experiment $EXP --project $PROJ --events $AAL
</code></pre>
<p>Once run, you will see the orchestrator step through the events in the AAL file. The output will be as follows:</p>
<pre><code>stream groupBuildS... : sent : (16:17:14) joinGroup flooder_group --&gt; __ALL__ 
stream groupBuildS... : sent : (16:17:14) joinGroup server_group --&gt; __ALL__ 
stream groupBuildS... : trig : (16:17:15) trigger completed: GroupBuildDone: {'group': 'flooder_group'}
stream groupBuildS... : trig : (16:17:15) trigger completed: GroupBuildDone: {'group': 'server_group'}
stream groupBuildS... : sent : (16:17:15) groupPing(['flooder_group']) --&gt; flooder_group 
stream groupBuildS... : sent : (16:17:15) groupPing(['server_group']) --&gt; server_group 
stream groupBuildS... : trig : (16:17:15) trigger completed: GroupPong: {'group': 'flooder_group'}
stream groupBuildS... : trig : (16:17:15) trigger completed: GroupPong: {'group': 'server_group'}
stream groupBuildS... : DONE : (16:17:15) complete.
stream loadAgentSt... : sent : (16:17:15) loadAgent flooder_agent --&gt; flooder_group 
stream loadAgentSt... : sent : (16:17:15) loadAgent server_agent --&gt; server_group 
stream loadAgentSt... : trig : (16:17:27) trigger completed: AgentLoadDone: {'agent': 'flooder_agent'}
stream loadAgentSt... : trig : (16:18:03) trigger completed: AgentLoadDone: {'agent': 'server_agent'}
stream loadAgentSt... : DONE : (16:18:03) complete.
04-24 16:18:03.371 magi.orchestrator.orchestrator INFO     Running Event Streams
stream flooderstream  : sent : (16:18:03) setConfiguration(['udp',  '10.1.1.3', ... ) --&gt; flooder_group 
stream serverstream   : sent : (16:18:03) startServer(None) --&gt; server_group  (fires trigger: serverStarted)
stream flooderstream  : trig : (16:18:05) trigger completed: serverStarted: {'retVal': True}
stream flooderstream  : sent : (16:18:05) startFlood(None) --&gt; flooder_group 
04-24 16:18:05.624 magi.orchestrator.orchestrator CRITICAL Got a runtime exception from an agent. Jumping to exit target.
stream unknown        : exit : (16:18:05) Run-time exception in agent &lt;magi.modules.flooder_agent_code.flooder.flooder_agent object at 0x7f47e2243490&gt; on node(s) floodernode in method _execute_child, line 1343, in file subprocess.py. Error: [Errno 2] No such file or directory
04-24 16:18:05.625 magi.orchestrator.orchestrator INFO     Running Exit Streams
stream unloadAgent... : sent : (16:18:05) unloadAgent flooder_agent --&gt; flooder_group 
stream unloadAgent... : sent : (16:18:05) unloadAgent server_agent --&gt; server_group 
stream unloadAgent... : trig : (16:18:06) trigger completed: AgentUnloadDone: {'agent': 'flooder_agent'}
stream unloadAgent... : trig : (16:18:06) trigger completed: AgentUnloadDone: {'agent': 'server_agent'}
stream unloadAgent... : DONE : (16:18:06) complete.
stream groupLeaveS... : sent : (16:18:06) leaveGroup flooder_group --&gt; __ALL__ 
stream groupLeaveS... : sent : (16:18:06) leaveGroup server_group --&gt; __ALL__ 
stream groupLeaveS... : trig : (16:18:06) trigger completed: GroupTeardownDone: {'group': 'flooder_group'}
stream groupLeaveS... : trig : (16:18:06) trigger completed: GroupTeardownDone: {'group': 'server_group'}
stream groupLeaveS... : DONE : (16:18:06) complete.
</code></pre>
<p>The orchestration tool runs an internally defined stream called initilization that is responsible for establishing the server_group and the flooder_group and loading the agents. Once the agents are loaded, as indicated by the received trigger AgentLoadDone, The initialization stream is complete.</p>
<p>Now the serverstream, flooderstream and the cleanupstream start concurrently. The serverstream sends the startServer event to the server_group. All members of the server_group start the server and fire a trigger serverStarted.</p>
<p>The flooderstream on receiving the trigger <em>serverStarted</em> from the server_group, sends the <em>startFlood</em> event to the flooder_group. One minute later, the clientstream sends the trigger <em>stopFlood</em> to the flooder_group. This sequence of events repeats one more time before sending the final <em>stopFlood</em> trigger to the flooder_group, terminating the flooder_agent.</p>
<p>Once the serverstream finishes the wait period, it sends out <em>stopServer</em> on the server_group. Once all the servers are stopped, the members of the server_group respond with a <em>serverStopped</em> trigger, which is forwarded to the cleanupstream. </p>
<p>The procedure and topology file that were used for the casestudy are attached below. </p>
<p><strong>Procedure</strong>: <a href="../procedure.aal">casestudy_flooder.aal</a></p>
<p><strong>Topology</strong> : <a href="../topology.tcl">casestudy_flooder.tcl</a></p>
<p><strong>Archived logs</strong>:  <a href="../cs_exparchive_flooder.tar.gz">casestudy_flooder.tar.gz</a></p>
<h2 id="visualizing-experiment-results">Visualizing Experiment Results<a class="headerlink" href="#visualizing-experiment-results" title="Permanent link"></a></h2>
<p>In order to visulaize the traffic on the network, we modify the above mentioned procedure to add another stream called “monitor”. This stream deploys a packet sensor agent on the server node to measure the traffic on the link in the experiment. The packet sensor agent records the traffic data using MAGI’s data management layer.</p>
<pre><code>monitor_group: [servernode]

monitor_agent:
  group: monitor_group
  path: /share/magi/modules/pktcounters/pktCountersAgent.tar.gz
  execargs: {}
</code></pre>
<pre><code>monitorstream:
    - type: trigger
      triggers: [ { event: serverStarted  }  ]

    - type: event
      agent: monitor_agent
      method: startCollection
      trigger: collectionServer
      args: {}

    - type: trigger
      triggers: [ { event: serverStopped  }  ]

    - type: event
      agent: monitor_agent
      method: stopCollection
      args: {}
</code></pre>
<p>The recorded data is then pulled out by the below mentioned tools to create a traffic plot.</p>
<p>In order to populate the traffic data, re-orchestrate the experiment using the updated procedure. The updated procedure file and the corresponding logs are attached below.</p>
<p>A plot of the traffic on the link containing the flooder and the victim server can be generated by the <a href="magi-tools/#magi_graph.py">MAGI Graph Creation Tool</a>.</p>
<pre><code class="language-bash">$ export GRAPHCONF=graph.conf
$ /share/magi/current/magi_graph.py -e $EXP -p $PROJ -c $GRAPHCONF -o traffic_plot.png
</code></pre>
<p><img alt="Graph" src="../traffic_plot.png" /></p>
<p><strong>Procedure</strong>   :   <a href="../flooder_monitor.aal">flooder_monitor.aal</a></p>
<p><strong>Archived logs</strong>:  <a href="../cs_exparchive_flooder_monitor.tar.gz">casestudy_flooder_monitor.tar.gz</a></p>
<p><strong>Graph Config</strong>:   <a href="../graph.conf">graph.conf</a></p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2018 <a href="https://www.deter-project.org/">DETER Project</a>.</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
  <script>var base_url = '../..';</script>
  <script src="../../js/theme.js"></script>
    <script src="../../search/main.js"></script>
  <!-- this makes the active part of the navigation sidebar scroll to top -->
<script type="text/javascript">
$(document).ready(function () {

  if ($("a").hasClass("current")) {
    var container = $("nav"),
    scrollTo = $("a.current");

    container.scrollTop(
    scrollTo.offset().top - container.offset().top + container.scrollTop() - 92
    );
    
    }
});
</script>

</body>
</html>
