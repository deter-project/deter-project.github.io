<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Simple Client Server Case Study - DETERLab Documentation</title>
  

  <link rel="shortcut icon" href="../../favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Simple Client Server Case Study";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> DETERLab Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Welcome to the DETERLab Documentation</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../glossary/">Glossary</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>DETERLab Core</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/core-quickstart/">Core Quickstart</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/core-guide/">Core Guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/sample-topologies/">Sample Topologies</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/using-nodes/">Using Your Nodes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/generating-traffic/">Generating Traffic</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/link-delays/">End Node Traffic Shaping</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/sharing/">Using Shared Materials</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Core Reference</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/deterlab-commands/">DETERLab Commands</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/ns-commands/">NS Commands Extensions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/swapping/">Understanding Swapping (Node Use Policies)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/DETERSSH/">Accessing testbeds using SSH</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/node-types/">DETERLab Node Types</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/serial-console/">Using the Serial Console</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/dell-serial-console/">Dell Serial Console</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/os-images/">OS Images</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/custom-images/">Creating Custom Images</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/windows/">Windows XP</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../core/legacy-tools/">Legacy Tools</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Orchestrator</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../orchestrator-quickstart/">Orchestrator Quickstart</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../orchestrator-guide/">Orchestrator Guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../orchestrator-case-studies/">Orchestrator Case Studies</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Simple Client Server Case Study</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#event-streams">Event Streams</a></li>
                
                    <li><a class="toctree-l4" href="#server-stream">Server Stream</a></li>
                
                    <li><a class="toctree-l4" href="#client-stream">Client Stream</a></li>
                
                    <li><a class="toctree-l4" href="#cleanup-stream">Cleanup Stream</a></li>
                
            
                <li class="toctree-l3"><a href="#running-the-experiment">Running the Experiment</a></li>
                
                    <li><a class="toctree-l4" href="#step-1-swap-in-the-experiment">Step 1: Swap in the experiment</a></li>
                
                    <li><a class="toctree-l4" href="#step-2-set-up-your-environment">Step 2: Set up your environment</a></li>
                
                    <li><a class="toctree-l4" href="#step-3-run-the-orchestrator">Step 3: Run the Orchestrator</a></li>
                
            
                <li class="toctree-l3"><a href="#visualizing-experiment-results">Visualizing Experiment Results</a></li>
                
                    <li><a class="toctree-l4" href="#offline-plotting">Offline Plotting</a></li>
                
                    <li><a class="toctree-l4" href="#real-time-plotting">Real-time Plotting</a></li>
                
            
                <li class="toctree-l3"><a href="#scaling-the-experiment">Scaling the Experiment</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../scaled-client-server/">Scaled Client Server Case Study</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../feedback/">Feedback Case Study</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../writing-agents/">Writing Your Own MAGI Agents</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../agent-configuration/">Configuring a MAGI Agent at Runtime</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../orchestrator-reference/">Orchestrator Reference</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../system-files/">MAGI System Files</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../agent-library/">MAGI Agent Library</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../magi-tools/">MAGI Tools</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Containers</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../containers/containers-quickstart/">Containers Quickstart</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../containers/containers-guide/">Containers Guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../containers/containers-reference/">Containers Reference</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Other Features</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../federation/">Federation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../abac/">ABAC</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Miscellaneous</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ISIUCB/">DETERLab Rooms</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>About</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../about/release-notes/">Release Notes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../about/contributing/">Contributing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../about/license/">License</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">DETERLab Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Orchestrator &raquo;</li>
        
      
    
    <li>Simple Client Server Case Study</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>In this example, we demonstrate how to set up client and server traffic generators with only one server and one client. (In the <a href="/orchestrator/scaled-client-server/">Scaled Server Case Study</a>, we will show how the same procedure can be used for a significantly larger topology.)</p>
<p>We demonstrate three aspects of MAGI: specifying multiple event streams, synchronizing with triggers, and a special target called <code>exit</code> to unload agents.</p>
<h2 id="event-streams">Event Streams<a class="headerlink" href="#event-streams" title="Permanent link"></a></h2>
<p>This example has three events streams; the server stream, the client stream, and the cleanup stream.</p>
<p>The coordination between the events can be illustrated as follows:</p>
<p><img alt="Example of events streams in Orchestrator" src="../../img/cs_workflow.png" /></p>
<p>Event streams can be synchronized using <em>event-based triggers</em> (such as after the server has started) or <em>time-based triggers</em> (such as wait for 30 seconds). The triggers are indicated as <em>wait</em> states (in gray). Forming the groups and loading the agents, which are also automated by the orchestrator tool, are not illustrated above.</p>
<h3 id="server-stream">Server Stream<a class="headerlink" href="#server-stream" title="Permanent link"></a></h3>
<p>The server event stream consists of three states. </p>
<ol>
<li>
<p>The <strong>start</strong> state generates a trigger, called <code>serverStarted</code>, once the server agent is activated on the experiment nodes.</p>
</li>
<li>
<p>It then enters the <strong>wait</strong> state where it waits for a trigger from the client event stream.</p>
</li>
<li>
<p>Once the trigger is received, it enters the <strong>stop</strong> state, when the server is deactivated or terminated.</p>
</li>
</ol>
<p>Here is the relevant AAL description:</p>
<pre><code>serverstream:
    - type: event
      agent: server_agent
      method: startServer
        trigger: serverStarted
      args: {}

    - type: trigger
      triggers: [ {event: ClientStopped} ]

    - type: event
      agent: server_agent
      method: stopServer
      trigger: ServerStopped
      args: {}
</code></pre>

<h3 id="client-stream">Client Stream<a class="headerlink" href="#client-stream" title="Permanent link"></a></h3>
<p>The client event stream consists of five states. </p>
<ol>
<li>First, the client agent implementation is <strong>parameterized</strong> by the configuration state. This occurs as part of the agent loading process.</li>
<li>The client stream then <strong>synchronizes</strong> with the server stream by waiting for the <code>serverStarted</code> trigger from the server nodes. </li>
<li>Once it receives the trigger, the client agent is <strong>activated</strong> in the start state.</li>
<li>Next, the client stream <strong>waits</strong> for a period of time and then <strong>terminates</strong> the client agents in the stop state.</li>
<li>On termination, the client agents send a <code>clientStopped</code> trigger that allows the server stream to synchronize and terminate the servers only after all the client have terminated.</li>
</ol>
<p>Here is the relevant AAL description:</p>
<pre><code>clientstream:
    - type: trigger
      triggers: [ {event: ServerStarted} ]

    - type: event
      agent: client_agent
      method: startClient
      args: {}

    - type: trigger
      triggers: [ {timeout: 60000} ]

    - type: event
      agent: client_agent
      method: stopClient
      trigger: clientStopped
      args: {}

</code></pre>

<h3 id="cleanup-stream">Cleanup Stream<a class="headerlink" href="#cleanup-stream" title="Permanent link"></a></h3>
<p>The last event stream, the cleanup stream consists of two states. </p>
<ol>
<li>First, it <strong>waits</strong> for all the servers to stop.</li>
<li>Then it enters the <strong>exit</strong> state.</li>
</ol>
<p>The exit state unloads and tears down all the communication mechanisms between the agents. The exit state is entered by the key target and is used to transfer control to a reserved state internal to the Orchestrator.</p>
<p>It causes the Orchestrator to send agent <code>unload</code> and <code>disband</code> group messages to all of the experiment nodes and then it exits the Orchestrator.</p>
<p>Here is the relevant AAL code:</p>
<pre><code>
cleanup:
    - type: trigger
      triggers: [ {event: ServerStopped, target: exit} ]

</code></pre>

<h2 id="running-the-experiment">Running the Experiment<a class="headerlink" href="#running-the-experiment" title="Permanent link"></a></h2>
<h3 id="step-1-swap-in-the-experiment">Step 1: Swap in the experiment<a class="headerlink" href="#step-1-swap-in-the-experiment" title="Permanent link"></a></h3>
<p>Swap in the experiment using this network description file: <a href="/downloads/casestudy_clientserver.tcl">casestudy_clientserver.tcl</a>.</p>
<h3 id="step-2-set-up-your-environment">Step 2: Set up your environment<a class="headerlink" href="#step-2-set-up-your-environment" title="Permanent link"></a></h3>
<p>Assuming your experiment is named <code>myExp</code>, your project is named <code>myProj</code>, and the AAL file is called <strong>casestudy_clientserver.aal</strong>, include this in your environment:</p>
<pre><code>PROJ=myExp
EXP=myProj
AAL=casestudy_clientserver.aal
</code></pre>

<h3 id="step-3-run-the-orchestrator">Step 3: Run the Orchestrator<a class="headerlink" href="#step-3-run-the-orchestrator" title="Permanent link"></a></h3>
<p>Once the experiment is swapped in, run the Orchestrator using this AAL file: <a href="/downloads/casestudy_clientserver.aal">casestudy_clientserver.aal</a>. </p>
<pre><code>&gt; /share/magi/current/magi_orchestrator.py --experiment $EXP --project $PROJ --events $AAL
</code></pre>

<p>Once run, you will see the orchestrator step through the events in the AAL file. The example output below uses the project <strong>montage</strong> with experiment <strong>caseClientServer</strong>. The output will be as follows:</p>
<p><img alt="Example of Orchestrator output" src="../../img/cs_orch.png" /></p>
<ol>
<li>The Orchestrator runs an internally defined stream called <code>initilization</code> that is responsible for establishing the <code>server_group</code> and the <code>client_group</code> and loading the agents. Once the agents are loaded, as indicated by the received trigger <code>AgentLoadDone</code>, the initialization stream is complete.</li>
<li>Now the <code>serverstream</code>, <code>clientstream</code> and the <code>cleanup</code> stream start concurrently. The <code>serverstream</code> sends the <code>startServer</code> event to the <code>server_group</code>. All members of the <code>server_group</code> start the server and fire a trigger <code>serverStarted</code>.</li>
<li>The <code>clientstream</code> then sends the <code>startClient</code> event to the client_group. One minute later, the <code>clientstream</code> sends the event <code>stopClient</code> to the client_group and terminates the <code>clientstream</code>. All members of the client_group terminate the client_agent and generate a <code>clientStopped</code> trigger which is sent back to the Orchestrator.</li>
<li>Once the <code>serverstream</code> receives the <code>clientStopped</code> trigger from the client_group, it sends out the <code>stopServer</code> event on the server_group. Once all the servers are stopped, the members of the server_group respond with a <code>serverStopped</code> trigger, which is forwarded to the <code>cleanupstream</code>.</li>
<li>Upon receiving the <code>serverStopped</code> trigger, the <code>cleanupstream</code> enacts an internally define stream called <code>exit</code> that is responsible for unloading agents and tearing down the groups.</li>
</ol>
<p>The experiment artifacts, the procedure and topology file that were used for the case study are attached below.</p>
<ul>
<li>Procedure: <a href="/downloads/casestudy_clientserver.aal">casestudy_clientserver.aal</a></li>
<li>Topology: <a href="/downloads/casestudy_clientserver.tcl">casestudy_clientserver.tcl</a></li>
<li>Archived Logs: <a href="/downloads/casestudy_clientserver.tar.gz">casestudy_clientserver.tar.gz</a></li>
</ul>
<h2 id="visualizing-experiment-results">Visualizing Experiment Results<a class="headerlink" href="#visualizing-experiment-results" title="Permanent link"></a></h2>
<p>In order to visualize the traffic on the network, modify the above-mentioned procedure to add another stream called <code>monitorstream</code>. This stream deploys a packet sensor agent on the server node to measure the traffic on the link in the experiment. The packet sensor agent records the traffic data using MAGI’s data management layer.</p>
<pre><code>monitor_group: [servernode]

monitor_agent:
  group: monitor_group
  path: /share/magi/modules/pktcounters/pktCountersAgent.tar.gz
  execargs: {}

monitorstream:
    - type: trigger
      triggers: [ { event: serverStarted } ]

    - type: event
      agent: monitor_agent
      method: startCollection
      trigger: collectionServer
      args: {}

    - type: trigger
      triggers: [ { event: clientStopped } ]

    - type: event
      agent: monitor_agent
      method: stopCollection
      args: {}
</code></pre>

<p>The recorded data is then pulled out by the [below mentioned] tools to create a traffic plot.</p>
<p>In order to populate the traffic data, re-run the experiment using the updated procedure file: <a href="/downloads/casestudy_clientserver_monitor.aal">casestudy_clientserver_monitor.aal</a>. The corresponding logs are also <a href="/downloads/casestudy_clientserver_monitor.tar.gz">available here</a>.</p>
<p>The traffic may then be plotted in two ways:</p>
<h3 id="offline-plotting">Offline Plotting<a class="headerlink" href="#offline-plotting" title="Permanent link"></a></h3>
<p>A plot of the traffic on the link connecting the client and the server can be generated by the MAGI Graph Creation Tool.</p>
<pre><code>&gt; GRAPHCONF=cs_magi_graph.conf
&gt; /share/magi/current/magi_graph.py -e $EXP -p $PROJ -c $GRAPHCONF -o cs_traffic_plot.png
</code></pre>

<p><img alt="Example of traffic plot" src="../../img/cs_traffic_plot.png" /></p>
<h3 id="real-time-plotting">Real-time Plotting<a class="headerlink" href="#real-time-plotting" title="Permanent link"></a></h3>
<p>A real time simulated traffic plot using canned data from a pre-run experiment may be visualized <a href="http://tau.isi.edu/magidemos/casestudy/clientserver55/traffic.html">here</a>.</p>
<p>A similar plot using live data may be plotted by visiting the same web page and additionally passing it the hostname of the database config node of your experiment.</p>
<p>You can find the database config node for your experiment by reading your experiment’s configuration file, similar to the following.</p>
<pre><code>&gt; cat /proj/myProject/exp/myExperiment/experiment.conf
</code></pre>

<p>The database config node is as follows:</p>
<pre><code>
dbdl:
  configHost: node-1

expdl:
  experimentName: myExperiment
  projectName: myProject
</code></pre>

<p>Then edit the simulated traffic plot URL, passing it the hostname.</p>
<pre><code>host=node-1.myExperiment.myProject

http://&lt;web-host&gt;/traffic.html?host=node-1.myExperiment.myProject
</code></pre>

<p>The procedure, graph configuration, and archived log files that were used for the visualization of this case study are attached below.</p>
<ul>
<li>Procedure: <a href="/downloads/casestudy_clientserver_monitor.aal">casestudy_clientserver_monitor.aal</a></li>
<li>Archived Logs: <a href="/downloads/casestudy_clientserver_monitor.tar.gz">casestudy_clientserver_monitor.tar.gz</a></li>
<li>Graph Config: <a href="/downloads/cs_magi_graph.conf">cs_magi_graph.conf</a></li>
</ul>
<h2 id="scaling-the-experiment">Scaling the Experiment<a class="headerlink" href="#scaling-the-experiment" title="Permanent link"></a></h2>
<p>Now suppose you wanted to generate web traffic for a larger topology. We discuss how the above AAL can be applied to a topology of 55 nodes in the <a href="/orchestrator/scaled-client-server/">next tutorial</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../scaled-client-server/" class="btn btn-neutral float-right" title="Scaled Client Server Case Study"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../orchestrator-case-studies/" class="btn btn-neutral" title="Orchestrator Case Studies"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2016 <a href="https://www.deter-project.org/">DETER Project</a>.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../orchestrator-case-studies/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../scaled-client-server/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
