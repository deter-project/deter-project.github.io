<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Creating Custom Images - DETERLab Docs</title>
  

  <link rel="shortcut icon" href="../../favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../css/extra.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Creating Custom Images";
    var mkdocs_page_input_path = "core/custom-images.md";
    var mkdocs_page_url = "/core/custom-images/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon"><img class="logo" style="float:left" src="/img/doc-logo.png"/> <span class="title">DETERLab Docs</span></a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Welcome to the DETERLab Documentation</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../Glossary/">Glossary</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>DETERLab Core</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../core-quickstart/">Core Quickstart</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../core-guide/">Core Guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../sample-topologies/">Sample Topologies</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../using-nodes/">Using Your Nodes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../generating-traffic/">Generating Traffic</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../link-delays/">End Node Traffic Shaping</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../sharing/">Using Shared Materials</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Core Reference</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../deterlab-commands/">DETERLab Commands</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../ns-commands/">NS Commands Extensions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../swapping/">Understanding Swapping (Node Use Policies)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../DETERSSH/">Accessing testbeds using SSH</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../node-types/">DETERLab Node Types</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../serial-console/">Using the Serial Console</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dell-serial-console/">Dell Serial Console</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../os-images/">OS Images</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Creating Custom Images</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#what-is-an-operating-system-id-osid-versus-an-image-id">What is an Operating System ID (OSID) versus an Image ID?</a></li>
                
            
                <li class="toctree-l3"><a href="#standard-testbed-images">Standard Testbed Images</a></li>
                
            
                <li class="toctree-l3"><a href="#creating-your-custom-image">Creating Your Custom Image</a></li>
                
            
                <li class="toctree-l3"><a href="#hints-when-making-new-os-images">Hints When Making New OS Images</a></li>
                
            
                <li class="toctree-l3"><a href="#updating-your-custom-image">Updating your Custom Image</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../windows/">Windows XP</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../legacy-tools/">Legacy Tools</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Orchestrator</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/orchestrator-quickstart/">Orchestrator Quickstart</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/orchestrator-guide/">Orchestrator Guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/orchestrator-case-studies/">Orchestrator Case Studies</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/simple-client-server/">Simple Client Server Case Study</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/scaled-client-server/">Scaled Client Server Case Study</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/feedback/">Feedback Case Study</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/writing-agents/">Writing Your Own MAGI Agents</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/agent-configuration/">Configuring a MAGI Agent at Runtime</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/orchestrator-reference/">Orchestrator Reference</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/system-files/">MAGI System Files</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/agent-library/">MAGI Agent Library</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../orchestrator/magi-tools/">MAGI Tools</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Containers</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../containers/containers-quickstart/">Containers Quickstart</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../containers/containers-guide/">Containers Guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../containers/containers-reference/">Containers Reference</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Other Features</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../federation/">Federation</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../abac/">ABAC</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Miscellaneous</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ISIUCB/">DETERLab Rooms</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>About</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../about/release-notes/">Release Notes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../about/contributing/">Contributing</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../about/license/">License</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">DETERLab Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <!--
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Core Reference &raquo;</li>
        
      
    
    <li>Creating Custom Images</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
        -->
          <div role="navigation" aria-label="breadcrumbs navigation">
            <!--
            
              

                
                  <h1>Core Reference &raquo;</h1>
                
              
            
          -->
            <h1>Creating Custom Images</h1>
          </div>
          <div role="main">
            <div class="section">
              
                <h2 id="what-is-an-operating-system-id-osid-versus-an-image-id">What is an Operating System ID (OSID) versus an Image ID?<a class="headerlink" href="#what-is-an-operating-system-id-osid-versus-an-image-id" title="Permanent link"></a></h2>
<p>In order to make the best use of custom operating system images, it is important to understand the difference between these two concepts.</p>
<ul>
<li>
<p>An <strong>Image ID</strong> is a descriptor for a disk image.  This can be an image of an entire disk, a partition of a disk, or a set of partitions of a disk.  By supporting multiple partitions, we can technically support different operating systems within the same disk image.  These are referred to as <em>combo images</em>.  The Image ID points to a real file that is stored in the directory <code>/proj/YourProjectName/images</code>.  Other critical information is associated with the Image ID, such as what node types are supported by the images and what operating systems are on each partition.  You can view the Image IDs on the <a href="https://www.isi.deterlab.net/showimageid_list.php3">List ImageIDs page</a>, which is in the <em>Experimentation</em> drop down menu on the testbed web interface.</p>
</li>
<li>
<p>An <strong>OSID</strong> describes an operating system which resides on a partition of a disk image.  Every Image ID will have at least one OSID associated with it.  In typical testbed usage, the Image ID and OSID will be the same since we usually do not put multiple operating systems on a single image.  You can view the OSIDs on the <a href="https://www.isi.deterlab.net/showosid_list.php3">List OSIDs page</a>, which is in the <em>Experimentation</em> drop down menu on the testbed web interface.</p>
</li>
</ul>
<h2 id="standard-testbed-images">Standard Testbed Images<a class="headerlink" href="#standard-testbed-images" title="Permanent link"></a></h2>
<p>We provide a number of supported testbed images here at DETERLab.  These images can be viewed by looking at the <a href="https://www.isi.deterlab.net/showosid_list.php3">Operating System ID list</a>.  </p>
<p>Most new operating system images that we support are whole disk images, which is different from the more traditional scheme of using partition 1 for FreeBSD and partition 2 for Linux.  To view what nodes a particular operating system image runs on and what sort of partition scheme it uses, please refer to the <a href="https://www.isi.deterlab.net/showimageid_list.php3">Image ID list page</a>.</p>
<p>The supported testbed images are listed in the <a href="/os-images/">Operating System Images</a> documentation page. </p>
<h2 id="custom-os-images"><a name="CustomOS"></a>Custom OS Images<a class="headerlink" href="#custom-os-images" title="Permanent link"></a></h2>
<p>If your set of operating system customizations cannot be easily contained within an RPM/TAR (or multiple RPM/TARs), then you can create your own custom OS image. DETERLab allows you to create your own disk images and load them on your experimental nodes automatically when your experiment is created or swapped in. </p>
<p>Once you have created a custom disk image (and the associated <a href="https://www.isi.deterlab.net/newimageid_ez.php3"> ImageID/OSID descriptor</a> for it, you can use that OSID in your NS file. When your experiment is swapped in, the testbed system will arrange for your disks to be loaded in parallel using a locally written multicast disk loading protocol. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Experience has shown that it is much faster to load a disk image on 10 nodes at once, then it is to load a bunch of RPMS or tarballs on each node as it boots. So while it may seem like overkill to create your own disk image, we can assure you it is not.</p>
</div>
<p>The most common approach is to use the <a href="https://www.isi.deterlab.net/newimageid_ez.php3">New Image Descriptor</a> form to create a disk image that contains a customized version of a standard Linux or the FreeBSD image. All you need to do is enter the node name in the form, and the testbed system will create the image for you automatically, notifying you via email when it is finished. You can then use that image in subsequent experiments by specifying the descriptor name in your NS file with the <a href="/core/ns-commands/#tb-set-node-os"><code>tb-set-node-os</code></a> command. When the experiment is configured, the proper image will be loaded on each node automatically by the system.</p>
<h2 id="creating-your-custom-image">Creating Your Custom Image<a class="headerlink" href="#creating-your-custom-image" title="Permanent link"></a></h2>
<p>A typical approach to creating your own disk image is using one of the default images as a base or template. To do this:</p>
<ol>
<li>
<p>Create a single-node Linux or FreeBSD experiment. In your NS file, use the appropriate <code>tb-set-node-os</code> command, as in the following example:</p>
<pre><code>tb-set-node-os $nodeA FBSD7-STD
tb-set-node-os $nodeA Ubuntu1004-STD
</code></pre>
</li>
<li>
<p>After your experiment has swapped in (you have received the email saying it is running), log into the node and load all of the software packages that you wish to load. If you want to install the latest version of the Linux kernel on one of our standard disk images, or on your own custom Linux image, be sure to arrange for any programs that need to be started at boot time. It is a good idea to reboot the node and make sure that everything is running as expected when it comes up.</p>
</li>
<li>If you are creating a Windows-based image, you <strong>must</strong> "prepare" the node. The final thing to do before grabbing the image is to login on the <a href="/core/using-nodes/#SerialConsole">console</a>, drop to single user mode, and run the <code>prepare</code> script. This is described in detail in the <a href="/core/windows/#Custom_images">custom Windows images</a> section of the Windows page.</li>
<li>Note the physical (<code>pcXXX</code>) name of the machine used!</li>
<li>Create an image descriptor and image using the <a href="https://www.isi.deterlab.net/newimageid_ez.php3">New Image Descriptor</a> form.</li>
<li>Wait for the email saying the image creation is done.</li>
<li>Now you can create a second single-node experiment to test your new image. In your NS file, use <code>tb-set-node-os</code> to select the OSID that you just created. Be sure to remove any RPM or tarball directives. Submit that NS file and wait for the email notification. Then log into the new node and check to make sure everything is running normally.</li>
<li>
<p>If everything is going well, terminate both of these single-node experiments. If not, release the experiment created in the previous step, and then go back and fix the original node (<code>pcXXX</code> above). Recreate the image as needed:</p>
<pre><code>create_image -p &lt;proj&gt; &lt;imageid&gt; &lt;node&gt;
</code></pre>
</li>
<li>
<p>Once your image is working properly, you can use it in any NS file by using the <code>tb-set-node-os</code> command. If you ever want to reload a node in your experiment, either with one of your images or with one of the default images, you can use the <code>os_load</code> command. Log into <code>users</code> and run:</p>
<pre><code>os_load -p &lt;proj&gt; -i &lt;imageid&gt; &lt;node&gt;
</code></pre>
<p>This program will run in the foreground, waiting until the image has been loaded. At that point you should log in and make sure everything is working okay. You might want to watch the console line as well (see the <a href="/core/using-nodes/#SerialConsole">Node Console section</a>). If you want to load the default image, then simply run:</p>
<pre><code>os_load &lt;node&gt;
</code></pre>
</li>
</ol>
<h2 id="hints-when-making-new-os-images">Hints When Making New OS Images<a class="headerlink" href="#hints-when-making-new-os-images" title="Permanent link"></a></h2>
<ol>
<li>Please, <strong>never</strong> try to create an image from a node or type that begins with the letter <strong>b</strong>, e.g. <strong>bpc183</strong> or  <strong>bpc2133</strong>. These nodes are located in Berkeley which is physically located 400 miles away from the <code>boss</code> and <code>users</code> servers.</li>
<li>
<p>After you have created an image, load it back and watch what happens through the serial port.</p>
<p>Consider creating a <strong>two</strong> node experiment, one to create the image and the other to load it back.</p>
<p>There is a command called <code>os_load</code> available on the <code>users</code> server:</p>
<pre><code>users% which os_load
/usr/testbed/bin/os_load
users% os_load -h
option -h not recognized
os_load [options] node [node ...]
os_load [options] -e pid,eid
where:
    -i    Specify image name; otherwise load default image
    -p    Specify project for finding image name (-i)
    -s    Do *not* wait for nodes to finish reloading
    -m    Specify internal image id (instead of -i and -p)
    -r    Do *not* reboot nodes; do that yourself
    -e    Reboot all nodes in an experiment
  node    Node to reboot (pcXXX)
</code></pre>
<p>While the second node is reloading, watch its progress in real time using the console command from the <code>users</code> server, ie:</p>
<pre><code>users% console pc193
</code></pre>
</li>
<li>
<p>If you think you've got a good image, but it flounders while coming up, create another experiment with an NS directive that says <em>"Even if you think the node has not booted, let my experiment swap in anyway."</em> This may allow you to log in through the console and figure out what went wrong. An example of such a directive is:</p>
<pre><code>tb-set-node-failure-action $nodeA "nonfatal"
</code></pre>
</li>
<li>
<p>Create whole disk images on a smaller machine rather than a single partition image.</p>
</li>
</ol>
<h2 id="updating-your-custom-image">Updating your Custom Image<a class="headerlink" href="#updating-your-custom-image" title="Permanent link"></a></h2>
<p>Once you have your image, it is easy to update it later by taking a new snapshot from a node running your image. Assuming you have swapped in an experiment with a node running your image and you have made changes to that node, use the DETERLab web interface to navigate to the descriptor page for your image:</p>
<ol>
<li>Use the <em>Experimentation</em> drop down menu, and choose <em>List ImageIDs</em> to see the entire list of Images you may access.</li>
<li>Find your custom image and click on it.</li>
<li>In the <em>More Options</em> menu, click on <em>Snapshot Node ...</em></li>
<li>Fill in the name of the node that is running your image, and click on <em>Go</em>.</li>
<li>As in the above instructions, wait for the email saying your image has been updated before you try and use the image.</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../windows/" class="btn btn-neutral float-right" title="Windows XP"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../os-images/" class="btn btn-neutral" title="OS Images"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2016 <a href="https://www.deter-project.org/">DETER Project</a>.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../os-images/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../windows/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
